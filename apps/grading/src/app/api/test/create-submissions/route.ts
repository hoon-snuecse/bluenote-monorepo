import { NextRequest, NextResponse } from 'next/server';
import prisma from '@/lib/prisma';

// 테스트 제출물 생성 (개발용)
export async function POST(request: NextRequest) {
  if (process.env.NODE_ENV !== 'development') {
    return NextResponse.json(
      { success: false, error: 'This endpoint is only available in development' },
      { status: 404 }
    );
  }

  try {
    const { assignmentId } = await request.json();
    
    if (!assignmentId) {
      return NextResponse.json(
        { success: false, error: 'assignmentId is required' },
        { status: 400 }
      );
    }

    // 테스트 학생 데이터
    const testStudents = [
      {
        name: '김민준',
        id: '2024001',
        content: `저는 우리 학교의 급식이 더 건강해져야 한다고 생각합니다.

첫째, 현재 급식에는 튀긴 음식이 너무 많습니다. 일주일에 3번 이상 튀김이 나오는데, 이는 학생들의 건강에 좋지 않습니다. 튀긴 음식 대신 구운 요리나 찐 요리를 늘려야 합니다.

둘째, 채소 반찬의 종류를 다양하게 해야 합니다. 매일 비슷한 나물 반찬만 나와서 학생들이 잘 먹지 않습니다. 샐러드나 과일을 더 자주 제공하면 좋겠습니다.

셋째, 음식의 간을 줄여야 합니다. 너무 짜거나 매운 음식이 많아서 물을 많이 마시게 됩니다. 싱겁고 담백한 맛의 음식을 늘리면 건강에도 좋고 맛도 좋을 것입니다.

이렇게 급식이 개선되면 학생들이 더 건강하게 성장할 수 있을 것입니다.`
      },
      {
        name: '이서연',
        id: '2024002',
        content: `학교 도서관을 24시간 개방해야 한다고 주장합니다.

현재 우리 학교 도서관은 오후 6시에 문을 닫습니다. 하지만 많은 학생들이 방과 후 활동이나 학원 때문에 도서관을 이용하기 어렵습니다. 

첫 번째 이유는 학습 효율성입니다. 저녁 시간이나 새벽 시간에 공부하는 것이 더 효과적인 학생들이 많습니다. 도서관이 24시간 열려있다면 각자의 생체리듬에 맞춰 공부할 수 있습니다.

두 번째로 공평한 학습 기회를 제공할 수 있습니다. 집에서 공부할 환경이 좋지 않은 학생들도 있습니다. 24시간 도서관은 모든 학생에게 동등한 학습 환경을 제공합니다.

마지막으로 안전 문제는 카드키 시스템과 CCTV로 해결할 수 있습니다. 실제로 많은 대학교에서 이미 24시간 도서관을 운영하고 있습니다.

따라서 학교 도서관의 24시간 개방은 학생들의 학업 성취도를 높이는 중요한 방법입니다.`
      },
      {
        name: '박진서',
        id: '2024003',
        content: `우리 학교에 반려동물 돌봄 프로그램을 만들어야 합니다.

많은 학생들이 반려동물을 키우고 싶어하지만 여러 이유로 키우지 못합니다. 학교에서 반려동물 돌봄 프로그램을 운영한다면 여러 장점이 있습니다.

첫째, 학생들의 정서적 안정에 도움이 됩니다. 동물과의 교감은 스트레스를 줄이고 행복감을 높입니다. 시험 기간에 특히 도움이 될 것입니다.

둘째, 책임감을 기를 수 있습니다. 동물을 돌보면서 생명의 소중함을 배우고, 규칙적인 돌봄 활동을 통해 책임감이 생깁니다.

셋째, 진로 탐색의 기회가 됩니다. 수의사나 동물 관련 직업에 관심 있는 학생들에게 좋은 경험이 될 것입니다.

프로그램은 토끼나 햄스터 같은 작은 동물부터 시작하면 좋겠습니다. 동물 알레르기가 있는 학생들을 위해 별도의 공간에서 운영하고, 전문가의 지도를 받아 안전하게 진행해야 합니다.

이 프로그램을 통해 학생들은 더 따뜻한 마음을 가진 사람으로 성장할 수 있을 것입니다.`
      },
      {
        name: '최지우',
        id: '2024004', 
        content: `교복 자율화를 실시해야 한다고 생각합니다.

현재의 교복 제도는 여러 문제점을 가지고 있습니다. 

첫째, 개성 표현의 자유를 제한합니다. 청소년기는 자아정체성을 형성하는 중요한 시기인데, 획일적인 교복은 이를 방해합니다. 자신만의 스타일을 찾아가는 것도 중요한 성장 과정입니다.

둘째, 경제적 부담이 큽니다. 교복 한 벌에 수십만 원이 들고, 성장기라 자주 바꿔야 합니다. 사복을 입으면 이미 가지고 있는 옷을 활용할 수 있어 경제적입니다.

셋째, 실용성이 떨어집니다. 교복은 활동하기 불편하고, 세탁도 어렵습니다. 특히 여름 교복은 너무 덥고, 겨울 교복은 충분히 따뜻하지 않습니다.

물론 교복 자율화에 대한 우려도 있습니다. 빈부격차가 드러날 수 있고, 너무 화려한 옷차림으로 학습 분위기가 흐트러질 수 있다는 것입니다. 

하지만 이는 적절한 복장 가이드라인으로 해결할 수 있습니다. 예를 들어, 노출이 심한 옷이나 혐오 표현이 있는 옷은 금지하는 등의 최소한의 규칙만 정하면 됩니다.

교복 자율화는 학생들의 자율성과 창의성을 기르는 좋은 방법이 될 것입니다.`
      },
      {
        name: '정하은',
        id: '2024005',
        content: `학교에 학생 휴게실을 만들어야 합니다.

우리 학교 학생들은 쉴 공간이 부족합니다. 점심시간이나 쉬는 시간에 교실 말고는 갈 곳이 없어서 복도에서 서성이는 학생들이 많습니다.

첫째, 학생들의 스트레스 해소에 도움이 됩니다. 편안한 소파와 쿠션이 있는 휴게실에서 잠시 쉬면 다음 수업에 더 집중할 수 있습니다.

둘째, 친구들과 대화할 수 있는 공간이 필요합니다. 교실에서는 공부하는 친구들 때문에 조용히 해야 하지만, 휴게실에서는 자유롭게 이야기할 수 있습니다.

셋째, 다양한 활동이 가능합니다. 보드게임을 하거나 책을 읽거나 음악을 들을 수 있는 공간이 있으면 학교생활이 더 즐거워질 것입니다.

휴게실에는 자판기도 설치하고, 충전기도 준비하면 좋겠습니다. 또한 학년별로 시간을 정해서 사용하면 혼잡하지 않을 것입니다.

이런 휴게실이 있다면 학생들이 학교를 더 좋아하게 될 것입니다.`
      }
    ];

    // 제출물 생성
    const submissions = await Promise.all(
      testStudents.map(student => 
        prisma.submission.create({
          data: {
            assignmentId,
            studentName: student.name,
            studentId: student.id,
            content: student.content
          }
        })
      )
    );

    return NextResponse.json({ 
      success: true, 
      message: `${submissions.length}개의 테스트 제출물이 생성되었습니다.`,
      submissions: submissions.map(s => ({
        id: s.id,
        studentName: s.studentName,
        studentId: s.studentId
      }))
    });
  } catch (error) {
    console.error('테스트 제출물 생성 오류:', error);
    return NextResponse.json(
      { success: false, error: '테스트 제출물 생성 중 오류가 발생했습니다.' },
      { status: 500 }
    );
  }
}